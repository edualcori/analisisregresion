install.packages("foreign") require(foreign)  sdemt216<-data.frame(read.dbf("C://Users//8//Desktop//sdemt216.dbf"))sdemt216$EDA<-as.numeric(sdemt216$EDA)sdemt216$INGOCUP<-as.numeric(sdemt216$INGOCUP)sdemt216$SEX<-as.numeric(sdemt216$SEX)sdemt216$HRSOCUP<-as.numeric(sdemt216$HRSOCUP)sdemt216$ANIOS_ESC<-as.numeric(sdemt216$ANIOS_ESC)base1<-subset(sdemt216,sdemt216$CD_A==25&sdemt216$REMUNE2C==1)var<-c("INGOCUP","SEX","EDA","HRSOCUP","ANIOS_ESC")base2<-base1[,var]base3<-subset(base2,base2$INGOCUP>=1&base2$INGOCUP<=3000)base4<-subset(base3,base3$EDA>=15&base3$EDA<=65)#APLICANDO LA REGRESIÓNhelp("cor")cor(base4,use="everything",method = "pearson")#INGOCUP         SEX        EDA     HRSOCUP   ANIOS_ESC#INGOCUP    1.00000000  0.18004569  0.1645588  0.47374858 -0.03041259#SEX        0.18004569  1.00000000  0.3429103 -0.03467788 -0.12259575#EDA        0.16455880  0.34291027  1.0000000  0.15782956 -0.33585651#HRSOCUP    0.47374858 -0.03467788  0.1578296  1.00000000 -0.04951381#ANIOS_ESC -0.03041259 -0.12259575 -0.3358565 -0.04951381  1.00000000#################################################################################################################modelo<-lm(base4$INGOCUP~base4$SEX+base4$EDA+base4$HRSOCUP+base4$ANIOS_ESC)summary(modelo)#Podemos observar que con este modelo solo tres variables salen significativas y tenemos una R ajustada muy baja con un valor de .2465#La ecuación con este modelo sería ingocup=917.813+273.613sex+ 1.599EDA+19.490HRSOCUP+ 5.972ANIOS_ESC#1.supuesto: varianza constanteplot(modelo,which=1,pch=4)#Observamos que aquellos elementos que podrian tener alta incidencia en nuestro modelo son las observaciones 67,71 y 112#2.Supuesto de normalidadplot(modelo,which=2,pch=4)#Los residuos tipificados si estan alrededor de la linea por lo tanto se asume normalidad,salvo en el quaintil 2 que está un poco desviado#3.Tercer supuesto#Los residuos están estandarizados por sus desviaciones estándar estimadas.plot(modelo,which=3,pch=4)#Se presenta una gráfica sin patrón observable#4. supuestoplot(modelo,which=5,pch=4)#Supone eliminar 8 y 112, ya que son las observaciones que podrian impactar el modelomodelo$ajustados<-fitted(modelo)#aqui añadimos una variable que se llama ajustadosmodelo$res<-residuals(modelo)modelo$rstud<-rstudent(modelo)########################################################################################################3install.packages("lmtest")require(lmtest)#Prueba de normalidadks.test(modelo$rstud,"pnorm")#Esta prueba arroja una P-Value mayor a .05(valor de .3718), por tanto no  se rechaza la hipotesis nula y  se acepta que hay normalidad#Prueba de homogeneidad de varianzasbptest(modelo,studentize = FALSE,data=modelo)#Tenemos un p-value mayor a .05(valor de .3277), por lo tanto el modelo  pasa la prueba de homogeneidad de las varianzas#Prueba de autocorrelacióndwtest(modelo,alternative="two.sided",data=modelo)#Tenemos una p-value de .8904 y DW de 1.9821, la p-value  cae dentro de los parametros aceptables, Y Dw  está en  limite  aceptable install.packages("car")require(car)outlierTest(modelo) influencePlot(modelo)#############################################################################################################install.packages("faraway")require(faraway)cooks.distance(modelo)dc<-cooks.distance(modelo)#Podemos ver que la observacion que mas influye en el modelo es la 14etiqueta<-rownames(modelo)halfnorm(dc,3, etiqueta)##################################################################################################################Crearemos todas la combinaciones posibles para ver cual es el mejor modelo segun la metodologia step by step backwardstep(modelo,direction="backward")#El mejor modelo propuesto es el siguiente con un AIC de 2185.5, el AIC más pequeño entre los modelos analizados#Modelo nuevo: ingocup~sex+hrsocupmodelonuevo<-lm(base4$INGOCUP~base4$SEX+base4$HRSOCUP)summary(modelonuevo)#como podemos observar la R ajustada tiene un valor diferente, ahora de .2543, pero ahora todas las variables son muy significativas#La nueva ecuación quedaria de la siguiente forma#ingocup=1008.38+285.91sex+19.67HRSOCUPanova(modelonuevo)#como podemos observar, se cumple el hecho de que la F debe ser mayor a 1 pero tenemos unos residuales bastante grandes summary(modelonuevo)#Se cumple que F>1 con un valor de 29.81, pero P-value>.05(valor de 8.497e-12)################################################################################################################Si queremos predecir el valor de INGOCUPinter<-seq(min(base4$INGOCUP),max(base4$INGOCUP), length=length(base4$INGOCUP)) bolpred<-data.frame(SEX=2, HRSOCUP=35,uso=inter) pred<-predict(modelonuevo,bolpred,interval= "prediction",se.fit=TRUE, data=base4) head(pred$fit) fit       lwr      upr#2268.530 1049.9583 3487.101#1569.623  347.8802 2791.367#2238.283 1011.5888 3464.978#1687.622  466.9868 2908.258#1766.288  545.9190 2986.657#1776.868  557.6540 2996.082
